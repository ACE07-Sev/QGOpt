

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Comparison of optimization methods on the complex Stiefel manifold &mdash; QGOpt 0.2a documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Quantum channel tomography" href="channel_tomography.html" />
    <link rel="prev" title="Entanglement renormalization" href="entanglement_renormalization.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> QGOpt
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="entanglement_renormalization.html">Entanglement renormalization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Comparison of optimization methods on the complex Stiefel manifold</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Generating-of-ill-conditioned-Hamiltonian">Generating of ill conditioned Hamiltonian</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Manifold-and-optimizers">Manifold and optimizers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Optimization-loop">Optimization loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Plotting-value-of-error-vs-iteration-for-each-optimizer.">Plotting value of error vs iteration for each optimizer.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="channel_tomography.html">Quantum channel tomography</a></li>
<li class="toctree-l1"><a class="reference internal" href="state_tomography.html">Quantum state tomography</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimal_povm.html">Optimal POVM</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QGOpt</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Comparison of optimization methods on the complex Stiefel manifold</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/comparison.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Comparison-of-optimization-methods-on-the-complex-Stiefel-manifold">
<h1>Comparison of optimization methods on the complex Stiefel manifold<a class="headerlink" href="#Comparison-of-optimization-methods-on-the-complex-Stiefel-manifold" title="Permalink to this headline">¶</a></h1>
<p>One can open this tutorial in Google Colab (is recommended)</p>
<p><a class="reference external" href="https://colab.research.google.com/github/LuchnikovI/QGOpt/blob/master/docs/source/comparison.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>In the given tutorial, we compare different first-order Riemannian optimization methods on the complex Stiefel manifold. We consider a toy example of Hamiltonian renormalization. We use isometric matrices (elements of the complex Stiefel manifold) to solve the following problem</p>
<div class="math notranslate nohighlight">
\[{\rm Tr}\left(V^\dagger H V\right)\rightarrow \min_{V\in \left\{V\in \mathbb{C}^{n\times m}|V^\dagger V = I\right\}}.\]</div>
<p>In the beginning, let us import some libraries.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>  <span class="c1"># tf 2.x</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">QGOpt</span> <span class="k">as</span> <span class="nn">qgo</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">!</span>pip install git+https://github.com/LuchnikovI/QGOpt
    <span class="kn">import</span> <span class="nn">QGOpt</span> <span class="k">as</span> <span class="nn">qgo</span>

<span class="c1"># Fix random seed to make results reproducable.</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Generating-of-ill-conditioned-Hamiltonian">
<h2>Generating of ill conditioned Hamiltonian<a class="headerlink" href="#Generating-of-ill-conditioned-Hamiltonian" title="Permalink to this headline">¶</a></h2>
<p>In order to compare several optimizers, one needs to consider ill conditioned problem. We generate an ill conditioned Hamiltonian in the following sense: <span class="math notranslate nohighlight">\(\log(\lambda_i)\sim {\rm uniform}(-3, 3)\)</span>, where <span class="math notranslate nohighlight">\(\lambda_i\)</span> is an eigenvalue of a Hamiltonian, <span class="math notranslate nohighlight">\({\rm uniform}(-3, 3)\)</span> is the uniform probability density on the segment <span class="math notranslate nohighlight">\([-3, 3]\)</span>. Therefore, a generated Hamiltonian contains eigenvalues of different scales, which makes the standard Riemannian gradient descent
inefficient. However, the Riemannian gradient descent with momentum and adaptive optimization methods still can solve the problem fast.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#============================================================#</span>
<span class="n">ham_dim</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># dimension of a Hamiltonian</span>
<span class="n">renorm_ham_dim</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># dimension of a renormalized Hamiltonian</span>
<span class="c1">#============================================================#</span>

<span class="sd">&#39;&#39;&#39;One can generate ill conditioned Hamiltonian in two steps:</span>
<span class="sd">at first one generates unitary matrix from the eigen decomposition</span>
<span class="sd">and then one generates ill conditioned spectrum&#39;&#39;&#39;</span>

<span class="c1"># First step (QR based random unitary)</span>
<span class="sd">&#39;&#39;&#39;Here we use real_to_complex function from QGOpt. This function is usefull</span>
<span class="sd">when we need to turn to complex representation of a tensor from</span>
<span class="sd">its real representation&#39;&#39;&#39;</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">qgo</span><span class="o">.</span><span class="n">manifolds</span><span class="o">.</span><span class="n">real_to_complex</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">((</span><span class="n">ham_dim</span><span class="p">,</span> <span class="n">ham_dim</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                                   <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
<span class="n">Q</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">qr</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>

<span class="c1"># Second stape (ill conditioned spectrum)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">((</span><span class="n">ham_dim</span><span class="p">,),</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

<span class="c1"># A hamiltonian (built from its eigen decomposition)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ik,k,jk-&gt;ij&#39;</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>

<span class="c1"># Plotting of spectyrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">bottom</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">H</span><span class="p">),</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;number of eigval&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;eigval&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.6/dist-packages/numpy/core/_asarray.py:138: ComplexWarning: Casting complex values to real discards the imaginary part
  return array(a, dtype, copy=False, order=order, subok=True)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;eigval&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/comparison_3_2.png" src="_images/comparison_3_2.png" />
</div>
</div>
</div>
<div class="section" id="Manifold-and-optimizers">
<h2>Manifold and optimizers<a class="headerlink" href="#Manifold-and-optimizers" title="Permalink to this headline">¶</a></h2>
<p>Here we define the complex Stiefel manifold and different optimizers to compare them with each other.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;At first, we define the complex Stiefel manifold with different retractions</span>
<span class="sd">and metrics&#39;&#39;&#39;</span>

<span class="c1">#======================= Different retractions and metrics ====================#</span>
<span class="n">m_cayley</span> <span class="o">=</span> <span class="n">qgo</span><span class="o">.</span><span class="n">manifolds</span><span class="o">.</span><span class="n">StiefelManifold</span><span class="p">(</span><span class="n">retraction</span><span class="o">=</span><span class="s1">&#39;cayley&#39;</span><span class="p">)</span>
<span class="n">m_svd</span> <span class="o">=</span> <span class="n">qgo</span><span class="o">.</span><span class="n">manifolds</span><span class="o">.</span><span class="n">StiefelManifold</span><span class="p">()</span>
<span class="n">m_cayley_canonical</span> <span class="o">=</span> <span class="n">qgo</span><span class="o">.</span><span class="n">manifolds</span><span class="o">.</span><span class="n">StiefelManifold</span><span class="p">(</span><span class="n">retraction</span><span class="o">=</span><span class="s1">&#39;cayley&#39;</span><span class="p">,</span>
                                                   <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;canonical&#39;</span><span class="p">)</span>
<span class="n">m_svd_canonical</span> <span class="o">=</span> <span class="n">qgo</span><span class="o">.</span><span class="n">manifolds</span><span class="o">.</span><span class="n">StiefelManifold</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;canonical&#39;</span><span class="p">)</span>
<span class="c1">#==============================================================================#</span>


<span class="sd">&#39;&#39;&#39;Then we define initial isometric matrix by using method random of</span>
<span class="sd">the manifold&#39;&#39;&#39;</span>
<span class="c1"># initial random isometric matrix</span>
<span class="n">q_in</span> <span class="o">=</span> <span class="n">m_svd</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">ham_dim</span><span class="p">,</span> <span class="n">renorm_ham_dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
<span class="c1"># its real representation</span>
<span class="n">q_in</span> <span class="o">=</span> <span class="n">qgo</span><span class="o">.</span><span class="n">manifolds</span><span class="o">.</span><span class="n">complex_to_real</span><span class="p">(</span><span class="n">q_in</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;The exact solution of a problem is known and given</span>
<span class="sd">by eigen decomposition.&#39;&#39;&#39;</span>
<span class="n">min_value</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">H</span><span class="p">)[:</span><span class="n">renorm_ham_dim</span><span class="p">]),</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;To compare different optimization methods, retractions and metrics we</span>
<span class="sd">define several optimizers and write them into the dict&#39;&#39;&#39;</span>
<span class="c1">#========================== Different optimizers ==============================#</span>
<span class="n">opts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;GD_cayley&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RSGD</span><span class="p">(</span><span class="n">m_cayley</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">),</span>
        <span class="s1">&#39;GD_svd&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RSGD</span><span class="p">(</span><span class="n">m_svd</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">),</span>
        <span class="s1">&#39;GD_cayley_with_momentum&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RSGD</span><span class="p">(</span><span class="n">m_cayley</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
        <span class="s1">&#39;GD_svd_with_momentum&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RSGD</span><span class="p">(</span><span class="n">m_svd</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
        <span class="s1">&#39;Adam_cayley&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RAdam</span><span class="p">(</span><span class="n">m_cayley</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
        <span class="s1">&#39;Adam_svd&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RAdam</span><span class="p">(</span><span class="n">m_svd</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
        <span class="s1">&#39;Adam_cayley_with_ams&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RAdam</span><span class="p">(</span><span class="n">m_cayley</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">ams</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;Adam_svd_with_ams&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RAdam</span><span class="p">(</span><span class="n">m_svd</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">ams</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;GD_cayley_canonical&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RSGD</span><span class="p">(</span><span class="n">m_cayley_canonical</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">),</span>
        <span class="s1">&#39;GD_svd__canonical&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RSGD</span><span class="p">(</span><span class="n">m_svd_canonical</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">),</span>
        <span class="s1">&#39;GD_cayley_with_momentum_canonical&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RSGD</span><span class="p">(</span><span class="n">m_cayley_canonical</span><span class="p">,</span>
                                                                <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
        <span class="s1">&#39;GD_svd_with_momentum_canonical&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RSGD</span><span class="p">(</span><span class="n">m_svd_canonical</span><span class="p">,</span>
                                                             <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
        <span class="s1">&#39;Adam_cayley_canonical&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RAdam</span><span class="p">(</span><span class="n">m_cayley_canonical</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
        <span class="s1">&#39;Adam_svd_canonical&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RAdam</span><span class="p">(</span><span class="n">m_svd_canonical</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
        <span class="s1">&#39;Adam_cayley_with_ams_canonical&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RAdam</span><span class="p">(</span><span class="n">m_cayley_canonical</span><span class="p">,</span>
                                                              <span class="mf">0.8</span><span class="p">,</span> <span class="n">ams</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;Adam_svd_with_ams_canonical&#39;</span><span class="p">:</span><span class="n">qgo</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RAdam</span><span class="p">(</span><span class="n">m_svd</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">ams</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
       <span class="p">}</span>
<span class="c1">#==============================================================================#</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Optimization-loop">
<h2>Optimization loop<a class="headerlink" href="#Optimization-loop" title="Permalink to this headline">¶</a></h2>
<p>Now we can solve the optimization problem</p>
<div class="math notranslate nohighlight">
\[{\rm Tr}\left(V^\dagger H V\right)\rightarrow \min_{V\in \left\{V\in \mathbb{C}^{n\times m}|V^\dagger V = I\right\}},\]</div>
<p>by using different types of Riemannian optimizers.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#=============================================#</span>
<span class="n">number_of_steps</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># number of iterations</span>
<span class="c1">#=============================================#</span>

<span class="n">err_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># the dict will be filled by lists of errors</span>

<span class="c1"># loop over dict of optimizers</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">opts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

    <span class="n">err</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># will be filled by error vs iter</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">q_in</span><span class="p">)</span>  <span class="c1"># turning initial isometry to variable</span>

    <span class="c1"># optimization loop</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_steps</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">tape</span><span class="p">:</span>
            <span class="c1"># turning isometry to its complex representation</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">qgo</span><span class="o">.</span><span class="n">manifolds</span><span class="o">.</span><span class="n">real_to_complex</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="c1"># result of renormalization</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">trace</span><span class="p">((</span><span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">adjoint</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">@</span> <span class="n">H</span> <span class="o">@</span> <span class="n">Z</span><span class="p">)),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="c1"># add value of error to the list of errors</span>
            <span class="n">err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span> <span class="o">-</span> <span class="n">min_value</span><span class="p">)</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>  <span class="c1"># gradient</span>

        <span class="c1"># optimization step (the same as in pure TensorFlow)</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">apply_gradients</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">grad</span><span class="p">],</span> <span class="p">[</span><span class="n">q</span><span class="p">]))</span>

    <span class="c1"># add list of errors to the dict</span>
    <span class="n">err_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">err</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Plotting-value-of-error-vs-iteration-for-each-optimizer.">
<h2>Plotting value of error vs iteration for each optimizer.<a class="headerlink" href="#Plotting-value-of-error-vs-iteration-for-each-optimizer." title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span>
          <span class="s1">&#39;r:&#39;</span><span class="p">,</span> <span class="s1">&#39;r-.&#39;</span><span class="p">,</span> <span class="s1">&#39;b:&#39;</span><span class="p">,</span> <span class="s1">&#39;b-.&#39;</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="s1">&#39;k-.&#39;</span><span class="p">,</span> <span class="s1">&#39;g:&#39;</span><span class="p">,</span> <span class="s1">&#39;g-.&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">err_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;iter&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;err&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;err&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/comparison_9_1.png" src="_images/comparison_9_1.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="channel_tomography.html" class="btn btn-neutral float-right" title="Quantum channel tomography" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="entanglement_renormalization.html" class="btn btn-neutral float-left" title="Entanglement renormalization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, I. Luhnikov, A. Ryzhov, M. Krechetov

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>